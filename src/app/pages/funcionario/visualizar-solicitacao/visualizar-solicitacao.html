@if(solicitacao){

  @if(!modalAberto){
  <div
    class="fixed inset-0 z-50 flex justify-center items-start overflow-y-auto bg-black/50 py-20"
    (click)="onFecharModal()"
  >
    <div
      class="bg-gradient-to-br from-white to-[#ccc] p-8 rounded-3xl shadow-xl w-min min-w-lg relative"
      (click)="$event.stopPropagation()"
    >
      <button
        (click)="onFecharModal()"
        class="absolute top-4 left-4 text-gray-200 hover:text-red-500 text-3xl cursor-pointer hover:font-bold transition">
          &times;
      </button>

      <div class="text-center mb-6">
        <h2 class="text-3xl font-extrabold text-gray-800 poppins">
          Detalhes da Solicitação
        </h2>
      </div>

      <div class="space-y-4">
        <div class="p-4 rounded-xl bg-gray-50 border border-gray-300">
          <div class="solicitacao-info">
            <p class="text-md text-gray-600">
              <span class="font-semibold">Cliente: </span>
              {{ solicitacao.cliente.nome }}
            </p>
            <p class="text-md text-gray-600">
              <span class="font-semibold">Email: </span>
              {{ solicitacao.cliente.email }}
            </p>
            <p class="text-md text-gray-600">
              <span class="font-semibold">Contato: </span>
              {{ solicitacao.cliente.telefone }}
            </p>
            <p class="text-md text-gray-600">
              <span class="font-semibold">Equipamento: </span>
              {{ solicitacao.descricaoEquipamento }}
            </p>
            <p class="text-md text-gray-600">
              <span class="font-semibold">Defeito: </span>
              {{ solicitacao.descricaoDefeito }}
            </p>
            <p class="text-md text-gray-600">
              <span class="font-semibold">Funcionario Responsável: </span>
              {{ funcionarioResponsavel.nome }}
            </p>
            <p class="text-md text-gray-600 font-bold">
              Status:
              <span [ngClass]="statusClasses(solicitacao.status)">{{ solicitacao.status.toUpperCase() }}</span>
            </p>
          </div>
        </div>

        <div class="p-4 rounded-xl bg-gray-100 border border-gray-300">
                <h3 class="text-lg font-bold text-gray-700">Orçamento</h3>

                @if(solicitacao.status === statusEnum.Aberta) {
                    <div class="flex flex-col gap-2">
                        <input
                            type="text"
                            [(ngModel)]="orcamento"
                            [class.border-red-500]="orcamentoSubmitted && !orcamento"
                            [class.border-gray-400]="!(orcamentoSubmitted && !orcamento)"
                            [class.focus:border-mm]="!(orcamentoSubmitted && !orcamento)"
                            [class.hover:border-mm]="!(orcamentoSubmitted && !orcamento)"
                            class="mb-1 mt-3 rounded-lg border placeholder:text-gray-400 overflow-hidden h-10 px-3 transition w-full focus:shadow-xl focus:shadow-mm-shadow"
                            placeholder="Digite o valor do orçamento aqui"
                            (keyup)="handleOrcamento($event)"
                        />
                        @if(orcamentoSubmitted && !orcamento){
                            <p class="text-red-500 text-sm mb-4">O valor do orçamento é obrigatório.</p>
                        }
                    </div>
                } @else {

                  <p class="text-md text-gray-600">
                      Valor: <span class="font-semibold">R$ {{ solicitacao.valorOrcamento }}</span>
                  </p>
                }
                
            </div>
        <div class="p-4 rounded-xl bg-gray-100 border border-gray-300">
          <h3 class="text-lg font-bold text-gray-700">Histórico de status</h3>
            <ul>
              @for (historico of solicitacao.historicoStatus; track $index){
                <li class="py-3 flex items-center border-t mt-2 border-gray-300">
                  <p class="font-semibold mr-6">{{ historico.data }}</p>
                  <p class="font-semibold mr-6">{{ historico.hora }}</p>
                  <p [ngClass]="statusClasses(historico.status)">{{ historico.status.toUpperCase() }}</p>
                </li>
              }
            </ul>
          </div>
        </div>

      <footer class="modal-footer flex justify-center gap-4 mt-8">
        @switch (solicitacao.status) {
          @case (statusEnum.Aberta) {
            <button
              class="bg-mm text-nowrap hover:bg-mm-dark h-[46px] px-4 rounded-xl transition font-regular text-white text-md cursor-pointer hover:shadow-xl hover:scale-[102%] active:scale-95"
              (click)="efetuarOrcamento()"
            >
              Efetuar Orçamento
            </button>
          }
          @case (statusEnum.Aprovada) {
            <button
              class="bg-mm text-nowrap hover:bg-mm-dark h-[46px] px-4 rounded-xl transition font-regular text-white text-md cursor-pointer hover:shadow-xl hover:scale-[102%] active:scale-95"
              (click)="abrirModal()"
            >
              Redirecionar
            </button>
          
            <button
              class="bg-success text-nowrap hover:bg-success-dark h-[46px] px-4 rounded-xl transition font-regular text-white text-md cursor-pointer hover:shadow-xl hover:scale-[102%] active:scale-95"
              (click)="abrirModalEfetuar()"
            >
              Efetuar Manutenção
            </button>
          }
          @case (statusEnum.Redirecionada) {
            <button
              class="bg-mm text-nowrap hover:bg-mm-dark h-[46px] px-4 rounded-xl transition font-regular text-white text-md cursor-pointer hover:shadow-xl hover:scale-[102%] active:scale-95"
              (click)="abrirModal()"
            >
              Redirecionar
            </button>
          
            <button
              class="bg-success text-nowrap hover:bg-success-dark h-[46px] px-4 rounded-xl transition font-regular text-white text-md cursor-pointer hover:shadow-xl hover:scale-[102%] active:scale-95"
              (click)="abrirModalEfetuar()"
            >
              Efetuar Manutenção
            </button>
            
          }
          @case (statusEnum.Paga) {
            <button
              class="bg-mm text-nowrap hover:bg-mm-dark h-[46px] px-4 rounded-xl transition font-regular text-white text-md cursor-pointer hover:shadow-xl hover:scale-[102%] active:scale-95"
              (click)="finalizarManutencao()"
            >
              Finalizar Manutenção
            </button>
          }
          @default {
            <button
              class="bg-gray-500 hover:bg-gray-600 text-nowrap h-[46px] px-4 rounded-xl transition font-regular text-white text-md cursor-pointer hover:shadow-xl hover:scale-[102%] active:scale-95"
              (click)="onFecharModal()"
            >
              Fechar
            </button>
          }
        }
      </footer>
    </div>
  </div>


  } @if(modalAberto){

    <div
      class="fixed inset-0 z-50 flex items-center justify-center bg-black/50"
      (click)="fecharMover()"
    >
      <div
        class="bg-gradient-to-br from-white to-[#ccc] p-8 rounded-3xl shadow-xl w-min relative"
        (click)="$event.stopPropagation()"
      >
        <button
          class="absolute top-4 left-4 text-gray-200 text-2xl font-bold cursor-pointer hover:text-gray-400 transition"
          (click)="fecharMover()"
        >
          X
        </button>
  
        <div class="text-center mb-6">
          <h2 class="text-3xl font-extrabold text-gray-800 poppins">
            Redirecionar manutenção
          </h2>
          <br />
          <h3 class="text-lg">
            Escolha o funcionário para redirecionar a manunteção
          </h3>
        </div>
        <div class="funcionarios w-min">
          @for (f of funcionarios; track f.id){
          <div class="funcionario-card w-min">
            <div class="funcioario-info">
              <p class="text-nowrap font-bold">
                Nome: <span class="font-normal">{{ f.nome }}</span>
              </p>
              <p class="text-nowrap font-bold">
                Email: <span class="font-normal">{{ f.email }}</span>
              </p>
            </div>
            <button
              (click)="mudarFuncionario(f.id!)"
              class="bg-mm text-nowrap hover:bg-mm-dark h-[46px] px-4 rounded-xl transition font-regular text-white text-md cursor-pointer hover:shadow-xl hover:scale-[102%] active:scale-95"
            >
              Redirecionar
            </button>
          </div>
          }
        </div>
  
        <footer class="modal-footer">
          <button
            class="bg-danger hover:bg-red-700 h-[46px] px-4 rounded-xl transition font-regular text-white text-md cursor-pointer hover:shadow-xl hover:scale-[102%] active:scale-95"
            (click)="fecharMover()"
          >
            Cancelar
          </button>
        </footer>
      </div>
    </div>
  }

    @if(modalEfetuarAberto){

        <app-efetuar-manutencao [solicitacao]="solicitacao" (fecharModal)="onFecharModal()" (operacaoConcluida)="notificarOperacao()"></app-efetuar-manutencao>
    }
}